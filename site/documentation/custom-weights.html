<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jun 28, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130628" />
    <meta http-equiv="Content-Language" content="en" />
    <title>CLAVIN Documentation - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>CLAVIN</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://beri.co" class="externalLink" title="Berico Technologies">
        Berico Technologies</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="http://github.com/Berico-Technologies/CLAVIN" class="externalLink" title="CLAVIN @ GitHub">
        CLAVIN @ GitHub</a>
        </li>
      <li class="divider ">/</li>
        <li class=""></li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2013-06-28</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 0.4.0</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                            
      <li>
    
                          <a href="../index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li>
    
                          <a href="../roadmap.html" title="Roadmap">
          <i class="none"></i>
        Roadmap</a>
            </li>
                              <li class="nav-header">Tutorials</li>
                                
      <li>
    
                          <a href="../tutorials/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../tutorials/fivemin-tutorial.html" title="5-Minute Tutorial">
          <i class="none"></i>
        5-Minute Tutorial</a>
            </li>
                              <li class="nav-header">Changelog</li>
                                
      <li>
    
                          <a href="../changelog/changes-v0.4.0.html" title="v0.4.0">
          <i class="none"></i>
        v0.4.0</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                                                                              
      <li>
    
                          <a href="javascript:void(0)" title="How CLAVIN Works">
          <i class="icon-chevron-down"></i>
        How CLAVIN Works</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/model.html" title="CLAVIN's Model">
          <i class="none"></i>
        CLAVIN's Model</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/workflow-tutorial.html" title="Processing Workflow">
          <i class="none"></i>
        Processing Workflow</a>
            </li>
              </ul>
        </li>
                                                                                
      <li>
    
                          <a href="javascript:void(0)" title="Building a Gazetteer Index">
          <i class="icon-chevron-down"></i>
        Building a Gazetteer Index</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/geonames-indexing.html" title="From Geonames">
          <i class="none"></i>
        From Geonames</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/custom-indexing.html" title="From Custom Source">
          <i class="none"></i>
        From Custom Source</a>
            </li>
              </ul>
        </li>
                                                                                                            
      <li>
    
                          <a href="javascript:void(0)" title="Advanced Topics">
          <i class="icon-chevron-down"></i>
        Advanced Topics</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/coordinate-parser.html" title="Creating a Coordinate Parser">
          <i class="none"></i>
        Creating a Coordinate Parser</a>
            </li>
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>Applying Custom Weights to Resolution</a>
          </li>
                      
      <li>
    
                          <a href="../documentation/multilingual.html" title="Resolving Locations in other Languages">
          <i class="none"></i>
        Resolving Locations in other Languages</a>
            </li>
              </ul>
        </li>
                              <li class="nav-header">Maven Information</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="http://maven.apache.org/" title="Maven" class="builtBy">
        <img class="builtBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>Applying Custom Weights to Resolution<a name="Applying_Custom_Weights_to_Resolution"></a></h2><p>CLAVIN 0.4.0 introduced the concept of weighted resolution (outside of relevancy at the index). This is especially important for coordinate resolution, where there is little context to determine which <tt>Place</tt> of many should be chosen in a given area (especially one that is exceptionally dense - like New York City).</p><p>Implementing custom weights for coordinate resolution in CLAVIN is trivial (we still need to complete the weighting strategy for plain-named locations). This tutorial will demonstrate exactly how it's done.</p><p>Pretend we had a use case where we wanted to emphasize the selection of Schools above other features. Perhaps we know that our audience is less concerned with big areas (like cities) and is more focused on what Geonames calls Spot features. To emphasize the selection of schools, we simply need to boost the score of all <tt>ResolvedCoordinate</tt>s that have the <tt>FeatureCode</tt> <tt>SCH</tt> (school).</p><p><tt>ResolvedCoordinateWeigher</tt>s are presented <tt>ResolvedCoordinate</tt> candidates, in addition to the plain-named locations, when a coordinate is extracted from the text. To influence the overall score of a <tt>ResolvedCoordinate</tt>, you simply need to add your weigher to the set of weighers influencing the selection of the <tt>ResolvedCoordinate</tt>.</p><div class="section"><h3>Step 1 - Implement a <tt>ResolvedCoordinateWeigher</tt><a name="Step_1_-_Implement_a_ResolvedCoordinateWeigher"></a></h3><p>In this case, we want to emphasize schools, so heres our really simple implementation:</p>
<div class="source"><pre class="prettyprint linenums">import java.util.Collection;
import com.berico.clavin.GeoParser;
import com.berico.clavin.GeoParserFactory;
import com.berico.clavin.Options;
import com.berico.clavin.extractor.LocationOccurrence;
import com.berico.clavin.gazetteer.FeatureCode;
import com.berico.clavin.resolver.ResolutionContext;
import com.berico.clavin.resolver.ResolvedCoordinate;
import com.berico.clavin.resolver.impl.strategies.coordinates.ResolvedCoordinateWeigher;

public class SchoolCoordinateWeigher implements ResolvedCoordinateWeigher {

  /**
   * Given a coordinate, reward entries that have the FeatureCode &quot;SCH&quot; (school), 
   * and penalize others.
   * @param item the result to evaluate.
   * @param context All co-occurring locations, to help provide context when weighing
   * the coordinate.
   * @param options If your weigher needs configuration, it can pull it from this
   * object.
   * @return weight used to influence the select of the coordinate.
   */
  @Override
  public double weigh(
      ResolvedCoordinate item,
      Collection&lt;LocationOccurrence&gt; context, 
      Options options) {
    
    // If this is a Spot feature.
    if (item.getKnownLocation()
        .getFeatureCode()
        .equals(FeatureCode.SCH)){
      
      // Give it an arbitrary bonus of &quot;3&quot;.
      return 3;
    }
    
    // Otherwise, penalize the item.
    return -3;
  }
}
</pre></div></div><div class="section"><h3>Step 2 - Register the Weigher with the <tt>GeoParserFactory</tt><a name="Step_2_-_Register_the_Weigher_with_the_GeoParserFactory"></a></h3><p>Simply add the <tt>ResolvedCoordinateWeigher</tt> with the <tt>GeoParserFactory</tt> by adding it to the list of <tt>DefaultCoordinateWeighers</tt>:</p>
<div class="source"><pre class="prettyprint linenums">GeoParserFactory.DefaultCoordinateWeighers.add(new SchoolCoordinateWeigher());
</pre></div></div><div class="section"><h3>Step 3 - Use the Standard <tt>GeoParser</tt> Workflow<a name="Step_3_-_Use_the_Standard_GeoParser_Workflow"></a></h3><p>Continue the normal workflow:</p>
<div class="source"><pre class="prettyprint linenums">GeoParser parser = GeoParserFactory.getDefault(&quot;IndexDirectory/&quot;);

ResolutionContext context = 
  parser.parse(
    &quot;I'm looking for a nice school around here: 38.9532, -77.3392.&quot;);

System.out.println(context.getCoordinates().get(0));
</pre></div><p>And you will see the following results:</p>
<div><pre>
22:14:43.958 [main] INFO  com.berico.clavin.GeoParser - Input Size: 61
22:14:43.973 [main] INFO  com.berico.clavin.GeoParser - Extracted Location Count: 0
22:14:43.979 [main] DEBUG c.b.c.e.c.BaseDdPatternParsingStrategy - From '38.9532, -77.3392', parsed Lat/Lon: 38.9532, -77.3392.
22:14:43.981 [main] INFO  com.berico.clavin.GeoParser - Extracted Coordinates Count: 1
22:14:43.981 [main] DEBUG c.b.c.r.impl.DefaultLocationResolver - Beginning resolution step.
22:14:43.981 [main] DEBUG c.b.c.r.impl.DefaultLocationResolver - Found 0 location candidate lists.
22:14:44.946 [main] DEBUG c.b.c.r.impl.DefaultLocationResolver - Found 1 coordinate candidate lists.
New Best: 0.09970562086930945, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 20.05904965600212km S of National Training School for Women and Girls (historical), [US]
New Best: 0.11606821479011531, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 17.231246328864234km WSW of Andrew Small Male and Female Academy (historical), [US]
New Best: 0.1168412863316477, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 17.117237089662872km SSW of Bells Mill Elementary School, [US]
New Best: 0.1364719642499379, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 14.65502464914444km SSW of Bullis School, [US]
New Best: 0.14195325200886444, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 14.089145346773082km SSW of Connelly School of the Holy Child, [US]
New Best: 0.16636372506902752, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 12.021851513424334km SSW of Manor Montessori School, [US]
New Best: 0.42611630520335275, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 4.693554261073285km ENE of A Scott Crossfield Elementary School, [US]
New Best: 0.5840560914583524, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 3.424328637693209km NW of Armstrong Elementary School, [US]
New Best: 0.6716661722289681, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 2.977669685764982km W of Aldrin Elementary School, [US]
New Best: 1.2025737469077873, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 0.27767851746865363km NNE of Carter Glass Library (historical), [US]
New Best: 9.454544034201737, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 0.12941177659941908km ENE of Fairfax County Government Offices, [US]
New Best: 37.15426343228997, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 0.046345362912706085km SW of Harvest Christian Fellowship Church, [US]
New Best: 1419.8423069941873, Loc: Resolved: &quot;38.9532, -77.3392&quot; as 0.0014086071320370847km NW of Sunset Hills Montessori School Childrens House, [US]
22:14:44.978 [main] DEBUG c.b.c.r.impl.DefaultLocationResolver - Selected 1 coordinates.
22:14:44.980 [main] DEBUG c.b.c.r.impl.DefaultLocationResolver - Selected 0 locations.
22:14:44.980 [main] INFO  com.berico.clavin.GeoParser - Resolved 0 locations and 1 coordinates.
Resolved: &quot;38.9532, -77.3392&quot; as 0.0014086071320370847km NW of Sunset Hills Montessori School Childrens House, [US]
</pre></div></div><div class="section"><h3>Summary<a name="Summary"></a></h3><p>Applying weights to resolution can help you tune your extraction results without having to significantly rewrite the resolution algorithm. More importantly, they were designed to be parallelized, weighing each candidate in isolation (not requiring all candidates to be presented to the weigher at once). This makes it easier to scale, though it may have an impact on accuracy.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                        <a href="http://beri.co">Berico Technologies</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
