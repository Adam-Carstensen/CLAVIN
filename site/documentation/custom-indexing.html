<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jun 28, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130628" />
    <meta http-equiv="Content-Language" content="en" />
    <title>CLAVIN Documentation - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>CLAVIN</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://beri.co" class="externalLink" title="Berico Technologies">
        Berico Technologies</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="http://github.com/Berico-Technologies/CLAVIN" class="externalLink" title="CLAVIN @ GitHub">
        CLAVIN @ GitHub</a>
        </li>
      <li class="divider ">/</li>
        <li class=""></li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2013-06-28</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 0.4.0</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                            
      <li>
    
                          <a href="../index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li>
    
                          <a href="../roadmap.html" title="Roadmap">
          <i class="none"></i>
        Roadmap</a>
            </li>
                              <li class="nav-header">Tutorials</li>
                                
      <li>
    
                          <a href="../tutorials/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../tutorials/fivemin-tutorial.html" title="5-Minute Tutorial">
          <i class="none"></i>
        5-Minute Tutorial</a>
            </li>
                              <li class="nav-header">Changelog</li>
                                
      <li>
    
                          <a href="../changelog/changes-v0.4.0.html" title="v0.4.0">
          <i class="none"></i>
        v0.4.0</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                                                                              
      <li>
    
                          <a href="javascript:void(0)" title="How CLAVIN Works">
          <i class="icon-chevron-down"></i>
        How CLAVIN Works</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/model.html" title="CLAVIN's Model">
          <i class="none"></i>
        CLAVIN's Model</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/workflow-tutorial.html" title="Processing Workflow">
          <i class="none"></i>
        Processing Workflow</a>
            </li>
              </ul>
        </li>
                                                                                          
      <li>
    
                          <a href="javascript:void(0)" title="Building a Gazetteer Index">
          <i class="icon-chevron-down"></i>
        Building a Gazetteer Index</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/geonames-indexing.html" title="From Geonames">
          <i class="none"></i>
        From Geonames</a>
            </li>
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>From Custom Source</a>
          </li>
              </ul>
        </li>
                                                                                                  
      <li>
    
                          <a href="javascript:void(0)" title="Advanced Topics">
          <i class="icon-chevron-down"></i>
        Advanced Topics</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../documentation/coordinate-parser.html" title="Creating a Coordinate Parser">
          <i class="none"></i>
        Creating a Coordinate Parser</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/custom-weights.html" title="Applying Custom Weights to Resolution">
          <i class="none"></i>
        Applying Custom Weights to Resolution</a>
            </li>
                      
      <li>
    
                          <a href="../documentation/multilingual.html" title="Resolving Locations in other Languages">
          <i class="none"></i>
        Resolving Locations in other Languages</a>
            </li>
              </ul>
        </li>
                              <li class="nav-header">Maven Information</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="http://maven.apache.org/" title="Maven" class="builtBy">
        <img class="builtBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>Building a Gazetteer Index From a Custom Source<a name="Building_a_Gazetteer_Index_From_a_Custom_Source"></a></h2><p>Version 0.4.0 allows the creation of custom CLAVIN indexes by extending <tt>IndexBuilder</tt>. The process is really straight forward, and offers users a lot of flexibility. </p><p>The <tt>IndexBuilder</tt> is going to do a lot for you. It's going to keep track of progress, handle the Lucene indexing details, handle the schema, handle command line argument parsing, etc. It will even print a nice banner with Cliff Clavin's face on it. What else could you want?</p><p>To create a custom index, follow these steps:</p><div class="section"><h3>Step 1 - Extend <tt>IndexBuilder</tt><a name="Step_1_-_Extend_IndexBuilder"></a></h3><p>Create a new class, name it whatever you want and have it extend <tt>com.berico.clavin.resolver.impl.lucene.IndexBuilder</tt>.</p>
<div class="source"><pre class="prettyprint linenums">public class CustomIndexBuilder extends IndexBuilder {}
</pre></div></div><div class="section"><h3>Step 2 - Call the <tt>IndexBuilder</tt>'s constructor.<a name="Step_2_-_Call_the_IndexBuilders_constructor."></a></h3><p>A lot of the work happens in the <tt>IndexBuilder</tt> constructor, so it needs to be called with the command line input.</p>
<div class="source"><pre class="prettyprint linenums">public CustomIndexBuilder(String[] args) throws Exception {
  super(args);
}
</pre></div></div><div class="section"><h3>Step 3 - Implement the <tt>main()</tt> entry point.<a name="Step_3_-_Implement_the_main_entry_point."></a></h3><p>You can't inherit a static method, so you will have to declare the main method in your class. In the main method, simply instantiate your object passing the command line args.</p>
<div class="source"><pre class="prettyprint linenums">public static void main(String[] args) throws Exception {
  new CustomIndexBuilder(args);
}
</pre></div></div><div class="section"><h3>Step 4 - Provide a Description for the Command Line.<a name="Step_4_-_Provide_a_Description_for_the_Command_Line."></a></h3><p>Provide a simple description of what your implementation of <tt>IndexBuilder</tt> does.</p>
<div class="source"><pre class="prettyprint linenums">@Override
protected String getDescription() {  
  return &quot;There's only one reliable place to find Cliff.&quot;;
}
</pre></div></div><div class="section"><h3>Step 5 - (Optionally) Extend the command line parser.<a name="Step_5_-_Optionally_Extend_the_command_line_parser."></a></h3><p>We use <a class="externalLink" href="http://argparse4j.sourceforge.net/">Argparse4J</a> to parse the command line arguments. At this point, the <tt>IndexBuilder</tt> has already extended it adding the index variable (this is where the index will be created). You are now given the option of registering your own arguments for use in configuring your <tt>IndexBuilder</tt>.</p>
<div class="source"><pre class="prettyprint linenums">@Override
protected void extend(ArgumentParser parser) {

  parser.addArgument(&quot;tagline&quot;)
    .metavar(&quot;Tagline&quot;)
    .type(String.class)
    .required(true)
    .help(&quot;Something you want to say about this place.&quot;);
  
  parser.addArgument(&quot;ssn&quot;)
    .metavar(&quot;SocialSecurityNumber&quot;)
    .type(String.class)
    .required(true)
    .help(&quot;SSN of user, you don't need to know why we collect this!&quot;);
}
</pre></div></div><div class="section"><h3>Step 6 - (Optionally) Initialize your <tt>IndexBuilder</tt>.<a name="Step_6_-_Optionally_Initialize_your_IndexBuilder."></a></h3><p>You will be provide an object that has your command line arguments. It is poorly named <tt>namespace</tt>. I like to think of it as <tt>ArgumentBucket</tt>. Collect your arguments and initialize services or connections to datasources, etc.</p>
<div class="source"><pre class="prettyprint linenums">@Override
protected void initialize(Namespace namespace) {
  
  tagline = namespace.getString(&quot;tagline&quot;);
  
  String ssn = namespace.getString(&quot;ssn&quot;);
  
  pl(&quot;Can you believe it?  This guy just gave me his SSN: %s&quot;, ssn);
}
</pre></div>
<blockquote><p>Note: <tt>pl(String, Object...)</tt> is a shortcut for <tt>System.out.println(String.format(String, Object...));</tt>. There's also a <tt>pl(String)</tt>, which is just a call to <tt>System.out.println(String)</tt>. We've even add a <tt>p()</tt> which does not print to a new line.</p>
</blockquote></div><div class="section"><h3>Step 7 - Begin iterating over datasource, adding Places to the index.<a name="Step_7_-_Begin_iterating_over_datasource_adding_Places_to_the_index."></a></h3><p>The super class has initialized, and is now passing control back to the <tt>CustomIndexBuilder</tt>. All you need to do is use your configuration to call some datasource and convert that data into <tt>Place</tt> objects.</p><p>The context is a simple mechanism to allow you to add <tt>Place</tt>s without needing to know the internals of how the <tt>IndexBuilder</tt> works. It ever provides a counter, letting you know how many records have been processed.</p><p>In the future, if new functionality is exposed, it will be in the context, alleviating you from having to read and understand the workflow of <tt>IndexBuilder</tt>.</p>
<div class="source"><pre class="prettyprint linenums">@Override
protected void begin(BuilderContext context) throws Exception {
  
  Place cheersBoston = new Place();
  
  cheersBoston.setName(&quot;Cheers Bar and Grill, Boston&quot;);
  
  cheersBoston.setAsciiName(&quot;Cheers&quot;);
  
  cheersBoston.setAlternateNames(
    Arrays.asList(
      &quot;A place where everbody knows you name&quot;,
      &quot;A place where everbody's glad you came&quot;));
  
  cheersBoston.setCenter(new LatLon(42.355927, -71.071137));
  
  cheersBoston.setPrimaryCountryCode(CountryCode.US);
  
  // You see, you can put whatever it is you want here.
  cheersBoston.setContext(tagline);
  
  // A Spot location.
  cheersBoston.setFeatureClass(FeatureClass.S);
  
  // A Restaurant.
  cheersBoston.setFeatureCode(FeatureCode.REST);
  
  // I doubt this place ever has 35 patrons.
  cheersBoston.setPopulation(35);
  
  // Add the place to the context to get indexed.
  context.add(cheersBoston);
  
  // You can get the record count at any time.
  pl(&quot;Wrote %s record(s).&quot;, context.getTotalProcessed());
}
</pre></div><p>As you can see, we created a <tt>Place</tt> record manually. You could get your data from virtually anywhere and build an index.</p></div><div class="section"><h3>Step 8 - Cleanup Resources.<a name="Step_8_-_Cleanup_Resources."></a></h3><p>Finally, the <tt>IndexBuilder</tt> will give you an opportunity to clean up resources. This is done regardless of whether an exception has occurred in <tt>begin()</tt> and only after <tt>begin()</tt> has fallen out of scope.</p>
<div class="source"><pre class="prettyprint linenums">@Override
protected void cleanup() throws Exception {
  
  pl(&quot;Cleaning up the joint, throwing out the drunks.&quot;);
}
</pre></div></div><div class="section"><h3>Step 9 - Creating a Run Script for the Custom <tt>IndexBuilder</tt>.<a name="Step_9_-_Creating_a_Run_Script_for_the_Custom_IndexBuilder."></a></h3><p>To run the custom indexer, we'll create a little script to launch the process and collect your input from the console.</p><p>Call this file something like <tt>build-custom-index.sh</tt> (it has been added to the <tt>scripts</tt> directory of the project as an example). Replace the <tt>com.berico.clavin.examples.CustomIndexBuilder</tt> with the name of the class you created.</p>
<div class="source"><pre class="prettyprint linenums">#!/usr/bin/env sh

TAGLINE=$1
SSN=$2

# This should be wherever you want the index located.
INDEXDIR=&quot;./CustomExampleIndexDirectory&quot;

if [ -d &quot;$INDEXDIR&quot; ]; then
  echo &quot;Deleting existing index.&quot;
  rm -R &quot;$INDEXDIR&quot;
fi

mvn clean compile

export MAVEN_OPTS=&quot;-Xmx2g&quot;

mvn exec:java  -Dexec.mainClass=&quot;com.berico.clavin.examples.CustomIndexBuilder&quot; -Dexec.args=&quot;$INDEXDIR $TAGLINE $SSN&quot;
</pre></div></div><div class="section"><h3>Step 10 - Running the Custom <tt>IndexBuilder</tt>.<a name="Step_10_-_Running_the_Custom_IndexBuilder."></a></h3><p>Assuming you have reference CLAVIN as a dependency in your Maven project, and youre in the root of that project:</p>
<div class="source"><pre class="prettyprint linenums">sh build-custom-index.sh CustomTagLine 123-45-6789
</pre></div><p>If you want to try this example from the root of the CLAVIN project, execute:</p>
<div class="source"><pre class="prettyprint linenums">sh scripts/build-custom-index.sh CustomTagLine 123-45-6789
</pre></div></div><div class="section"><h3>That's it, you're done!<a name="Thats_it_youre_done"></a></h3><p>If you want a better, real-world example, look at the <tt>GeonamesIndexBuilder</tt> in the <tt>com.berico.clavin.resolver.impl.lucene</tt> package.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                        <a href="http://beri.co">Berico Technologies</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
